-- VER0.4 --SDATE:14/03/2015 --EDATE:14/03/2015 --DESC: CHENGED TABLE HEADERS AS PER NEW CR BY :DIV

-- VER0.4 --SDATE:14/03/2015 --EDATE:14/03/2015 --DESC: ATTACHMENT_DETAILS TICKLER DATA BY :RL
-- VER0.3 --SDATE:14/03/2015 --EDATE:14/03/2015 --DESC:ADDED DOCUMENT_CATEGORY, ATTACHMENT_DETAILS TICKLER DATA BY :RL
-- VER0.2 --SDATE:13/03/2015 --EDATE:13/03/2015 --DESC:ADDED MEETING_TOPIC,MEETING_DETAILS TICKLER DATA BY :RL
-- VER0.1 ISSUE:2 CMT:1 STARTDATE:29/01/2014 ENDDATE:29/01/2014 DESC:SP FOR SHOWING TICKLER DATA DONE BY:DHIVYA

DROP PROCEDURE IF EXISTS SP_TS_AUDIT_HISTORY;
CREATE PROCEDURE SP_TS_AUDIT_HISTORY(
IN ULDID INTEGER,
IN USERSTAMP VARCHAR(50),
OUT TEMP_UARD_TICKLER_HISTORY TEXT)

BEGIN
-- VARAIABLE DECLARATION
	DECLARE UARD_TICKLER_HISTORY TEXT;
	DECLARE TEMP_TICKLER_HISTORY TEXT;
	DECLARE TEMP_TICKLERHISTORY TEXT;
	DECLARE USERSTAMP_ID INT;
	DECLARE TH_MINID INTEGER;
	DECLARE TH_MAXID INTEGER;
	DECLARE TEMP_TH_OLDVALUE TEXT;
	DECLARE TEMP_TH_NEWVALUE TEXT;
	DECLARE EMPID INTEGER;
	DECLARE TABCOLUMN TEXT;

-- ROLLBACK COMMAND
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN
		ROLLBACK;
		IF (TEMP_TICKLER_HISTORY IS NOT NULL) THEN
			SET @DROP_TEMP_TICKLER_HISTORY=(SELECT CONCAT('DROP TABLE IF EXISTS ',TEMP_TICKLER_HISTORY));
			PREPARE DROP_TEMP_TICKLER_HISTORY_STMT FROM @DROP_TEMP_TICKLER_HISTORY;
			EXECUTE DROP_TEMP_TICKLER_HISTORY_STMT;
		END IF;
	END;

	START TRANSACTION;
	SET AUTOCOMMIT=0;

-- SUB SP FOR CONVERTING USERSTAMP INTO ULDID
	CALL SP_TS_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULD_ID);
	SET USERSTAMP_ID=@ULD_ID;

	
	SET @EMPL_ID=ULDID;
	SET @EMPL_NAME=(SELECT ULD_WORKER_NAME FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=ULDID);
	
	SET UARD_TICKLER_HISTORY=(SELECT CONCAT('TEMP_UARD_TICKLER_HISTORY',SYSDATE()));
	SET UARD_TICKLER_HISTORY=(SELECT REPLACE(UARD_TICKLER_HISTORY,' ',''));
	SET UARD_TICKLER_HISTORY=(SELECT REPLACE(UARD_TICKLER_HISTORY,'-',''));
	SET UARD_TICKLER_HISTORY=(SELECT REPLACE(UARD_TICKLER_HISTORY,':',''));
	SET TEMP_UARD_TICKLER_HISTORY=(SELECT CONCAT(UARD_TICKLER_HISTORY,'_',USERSTAMP_ID));  

	SET @CREATE_TEMP_UARD_TICKLER_HISTORY=(SELECT CONCAT('CREATE TABLE ',TEMP_UARD_TICKLER_HISTORY,'(
	TH_ID INT NOT NULL,
	ULD_ID INT,
	WORKER_NAME VARCHAR(100),
	EVENT_TYPE VARCHAR(10)NOT NULL,
	TABLE_NAME VARCHAR(70)NOT NULL,
	TH_OLD_VALUE TEXT NOT NULL,
	TH_NEW_VALUE TEXT,
	TH_USERSTAMP VARCHAR(50)NOT NULL,
	TH_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP)'));
	PREPARE CREATE_TEMP_UARD_TICKLER_HISTORY_STMT FROM @CREATE_TEMP_UARD_TICKLER_HISTORY;
	EXECUTE CREATE_TEMP_UARD_TICKLER_HISTORY_STMT;

  	SET TEMP_TICKLERHISTORY=(SELECT CONCAT('TEMP_TICKLER_HISTORY',SYSDATE()));
	SET TEMP_TICKLERHISTORY=(SELECT REPLACE(TEMP_TICKLERHISTORY,' ',''));
	SET TEMP_TICKLERHISTORY=(SELECT REPLACE(TEMP_TICKLERHISTORY,'-',''));
	SET TEMP_TICKLERHISTORY=(SELECT REPLACE(TEMP_TICKLERHISTORY,':',''));
	SET TEMP_TICKLER_HISTORY=(SELECT CONCAT(TEMP_TICKLERHISTORY,'_',USERSTAMP_ID));

	SET @CREATE_TEMP_TICKLER_HISTORY=(SELECT CONCAT('CREATE TABLE ',TEMP_TICKLER_HISTORY,' (
	ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	TH_ID INTEGER NOT NULL,
	TP_ID INTEGER NOT NULL,
	ULD_ID INTEGER DEFAULT NULL,
	TTIP_ID INTEGER NOT NULL,
	TH_OLD_VALUE TEXT NOT NULL,
	TH_NEW_VALUE TEXT,
	TH_USERSTAMP_ID INT(2) NOT NULL,
	TH_TIMESTAMP TIMESTAMP NOT NULL)'));
	PREPARE CREATE_TEMP_TICKLER_HISTORY_STMT FROM @CREATE_TEMP_TICKLER_HISTORY;
	EXECUTE CREATE_TEMP_TICKLER_HISTORY_STMT;
	SET @CHECKFLAG=1;
	SET @INSERT_TEMP_TICKLER_HISTORY=(SELECT CONCAT('INSERT INTO ',TEMP_TICKLER_HISTORY,' 
	(TH_ID,TP_ID,ULD_ID,TTIP_ID,TH_OLD_VALUE,TH_NEW_VALUE,TH_USERSTAMP_ID,TH_TIMESTAMP)
	(SELECT * FROM LMC_TICKLER_HISTORY WHERE ((ULD_ID IS NULL AND TH_USERSTAMP_ID=',ULDID,') OR ULD_ID=',ULDID,'))'));
	PREPARE INSERT_TEMP_TICKLER_HISTORY_STMT FROM @INSERT_TEMP_TICKLER_HISTORY;
	EXECUTE INSERT_TEMP_TICKLER_HISTORY_STMT;
	SET @CHECKFLAG=2;
	SET @THMINID=(SELECT CONCAT('SELECT MIN(ID) INTO @MINID FROM ',TEMP_TICKLER_HISTORY));
	PREPARE THMINID_STMT FROM @THMINID;
	EXECUTE THMINID_STMT;

	SET @THMAXID=(SELECT CONCAT('SELECT MAX(ID) INTO @MAXID FROM ',TEMP_TICKLER_HISTORY));
	PREPARE THMAXID_STMT FROM @THMAXID;
	EXECUTE THMAXID_STMT;

	SET TH_MINID=@MINID;
	SET TH_MAXID=@MAXID;

	WHILE(TH_MINID<=TH_MAXID)DO  

		SET @SELECT_TICKLER_VALUES=(SELECT CONCAT('SELECT TH_ID,ULD_ID,TP_ID,TTIP_ID,TH_OLD_VALUE,TH_NEW_VALUE,TH_USERSTAMP_ID,TH_TIMESTAMP 
		INTO @THID,@ULDID,@TPID,@TTIPID,@TH_OLDVALUE,@TH_NEWVALUE,@THUSERSTAMP,@THTIMESTAMP FROM ',TEMP_TICKLER_HISTORY,' WHERE ID=',TH_MINID));
		PREPARE SELECT_TICKLER_VALUES_STMT FROM @SELECT_TICKLER_VALUES;
		EXECUTE SELECT_TICKLER_VALUES_STMT;

		SET TEMP_TH_OLDVALUE=@TH_OLDVALUE;
		SET TEMP_TH_NEWVALUE=@TH_NEWVALUE;

-- LMC_TEAM_REPORT_DETAILS
		IF (@TTIPID=20	) THEN
			
			IF (@TH_OLDVALUE IS NOT NULL) THEN
				
				UARD_OLD_LOOP : LOOP
					
					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;
					
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF EXISTS(SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = (select database()) AND TABLE_NAME = (SELECT TRIM(TTIP_DATA) FROM 
						LMC_TICKLER_TABID_PROFILE WHERE TTIP_ID=@TTIPID AND COLUMN_NAME=@FIELD_NAME)) THEN
						SET TABCOLUMN=@FIELD_NAME;
					END IF;

					IF TABCOLUMN='TOJ_ID' THEN

						IF (@VALUE REGEXP '^[0-9]') THEN

							IF (@FIELD_NAME REGEXP '^[0-9]' AND @COLUMN_VALUE IS NULL) THEN              
								SELECT TOJ_JOB  INTO @JOBNAME  FROM LMC_TYPE_OF_JOB  WHERE TOJ_ID=@FIELD_NAME;
								SET @REPLACE_STRING=(SELECT CONCAT(',',@JOBNAME));
								SET @VALUE=(SELECT CONCAT(',',@VALUE));
								SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
							END IF;

						END IF;

					END IF;
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @EMPNAME='<NULL>';
						SET @TYPEOFJOB='<NULL>';
						SET @TEAM='<NULL>';
						SET @CONTRAC_NO='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TRD_USERSTAMP_ID') THEN
						SELECT ULD_USERNAME INTO @USERSTAMP FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@USERSTAMP);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TOJ_ID') THEN
						SELECT TOJ_JOB INTO @TYPEOFJOB FROM LMC_TYPE_OF_JOB WHERE TOJ_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TOJ_JOB=',@TYPEOFJOB);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TC_ID') THEN
						SELECT TEAM_NAME INTO @TEAM FROM LMC_TEAM_CREATION WHERE TC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TEAM_NAME=',@TEAM);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TRD_USERSTAMP_ID') THEN
						SELECT ULD_USERNAME INTO @USERSTAMP FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@USERSTAMP);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='CLD_ID') THEN
						SELECT CLD_CONTRACT_NO INTO @CONTRAC_NO FROM LMC_CONTRACT_DETAILS WHERE CLD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('CLD_CONTRACT_NO=',@CONTRAC_NO);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;
					
					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN
				
				UARD_NEW_LOOP : LOOP
					
					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;
					
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF EXISTS(SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = (select database()) AND TABLE_NAME = (SELECT TRIM(TTIP_DATA) FROM 
						LMC_TICKLER_TABID_PROFILE WHERE TTIP_ID=@TTIPID AND COLUMN_NAME=@FIELD_NAME)) THEN
						SET TABCOLUMN=@FIELD_NAME;
					END IF;
					IF TABCOLUMN='TOJ_ID' THEN

						IF (@VALUE REGEXP '^[0-9]') THEN

							IF (@FIELD_NAME REGEXP '^[0-9]' AND @COLUMN_VALUE IS NULL) THEN              
								SELECT TOJ_JOB  INTO @JOBNAME  FROM LMC_TYPE_OF_JOB  WHERE TOJ_ID=@FIELD_NAME;
								SET @REPLACE_STRING=(SELECT CONCAT(',',@JOBNAME ));
								SET @VALUE=(SELECT CONCAT(',',@VALUE));
								SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
							END IF;

						END IF;

					END IF;

					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @EMPNAME='<NULL>';
						SET @TYPEOFJOB='<NULL>';
						SET @TEAM='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TOJ_ID') THEN
						SELECT TOJ_JOB INTO @TYPEOFJOB FROM LMC_TYPE_OF_JOB WHERE TOJ_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TOJ_JOB=',@TYPEOFJOB);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TC_ID') THEN
						SELECT TEAM_NAME INTO @TEAM FROM LMC_TEAM_CREATION WHERE TC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TEAM_NAME=',@TEAM);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TRD_USERSTAMP_ID') THEN
						SELECT ULD_USERNAME INTO @USERSTAMP FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@USERSTAMP);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='CLD_ID') THEN
						SELECT CLD_CONTRACT_NO INTO @CONTRAC_NO FROM LMC_CONTRACT_DETAILS WHERE CLD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('CLD_CONTRACT_NO=',@CONTRAC_NO);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP; 

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_TEAM_EMPLOYEE_REPORT_DETAILS
		IF (@TTIPID=18) OR (@TTIPID=19) OR (@TTIPID=21) OR (@TTIPID=22) OR (@TTIPID=23) OR (@TTIPID=24) OR (@TTIPID=31) OR (@TTIPID=32) OR  (@TTIPID=33) OR (@TTIPID=25) OR (@TTIPID=26) OR (@TTIPID=27)  OR (@TTIPID=38) OR (@TTIPID=39) THEN			
			
			IF (@TH_OLDVALUE IS NOT NULL) THEN
				
				UARD_OLD_LOOP : LOOP
					
					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;
					
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @EMPNAME='<NULL>';
						SET @MACITEM='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MI_ID') THEN
						SELECT MI_ITEM INTO @MACITEM FROM LMC_MACHINERY_ITEM WHERE MI_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MI_ITEM=',@MACITEM);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @EMPNAME='<NULL>';
						SET @MACITEM='<NULL>';

					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MI_ID') THEN
						SELECT MI_ITEM INTO @MACITEM FROM LMC_MACHINERY_ITEM WHERE MI_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MI_ITEM=',@MACITEM);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;


					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP; 

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_MACHINERY_USAGE_DETAILS
		IF (@TTIPID=28)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @MAC_TYPE='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MCU_ID') THEN
						SELECT MCU_MACHINERY_TYPE INTO @MAC_TYPE FROM LMC_MACHINERY_USAGE WHERE MCU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MCU_MACHINERY_TYPE=',@MAC_TYPE);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @MAC_TYPE='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MCU_ID') THEN
						SELECT MCU_MACHINERY_TYPE INTO @MAC_TYPE FROM LMC_MACHINERY_USAGE WHERE MCU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MCU_MACHINERY_TYPE=',@MAC_TYPE);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP; 

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_FITTING_USAGE_DETAILS
		IF (@TTIPID=29)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @FUITEMS='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='FU_ID') THEN
						SELECT FU_ITEMS INTO @FUITEMS FROM LMC_FITTING_USAGE WHERE FU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('FU_ITEMS=',@FUITEMS);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;
					
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @FUITEMS='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;
					
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;
					
					IF (UPPER(@FIELD_NAME)='FU_ID') THEN
						SELECT FU_ITEMS INTO @FUITEMS FROM LMC_FITTING_USAGE WHERE FU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('FU_ITEMS=',@FUITEMS);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;
				
					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP;  

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_MATERIAL_USAGE_DETAILS
		IF (@TTIPID=30)THEN
			
			IF (@TH_OLDVALUE IS NOT NULL) THEN
				
				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;
					
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @MUITEMS='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MU_ID') THEN
						SELECT MU_ITEMS INTO @MUITEMS FROM LMC_MATERIAL_USAGE WHERE MU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MU_ITEMS=',@MUITEMS);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @MUITEMS='<NULL>';
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MU_ID') THEN
						SELECT MU_ITEMS INTO @MUITEMS FROM LMC_MATERIAL_USAGE WHERE MU_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MU_ITEMS=',@MUITEMS);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP; 

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 



-- LMC_EMAIL_TEMPLATE_DETAILS
		IF (@TTIPID=13)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @SCRIPT='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='ET_ID') THEN
						SELECT ET_EMAIL_SCRIPT INTO @SCRIPT FROM LMC_EMAIL_TEMPLATE WHERE ET_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ET_EMAIL_SCRIPT=',@SCRIPT);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @TEAMNAME='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='ET_ID') THEN
						SELECT ET_EMAIL_SCRIPT INTO @SCRIPT FROM LMC_EMAIL_TEMPLATE WHERE ET_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ET_EMAIL_SCRIPT=',@SCRIPT);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP; 

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_MEETING_TOPIC
		IF (@TTIPID=34)THEN
			
			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN

				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP;  

			END IF;
			
			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_MEETING_DETAILS
		IF (@TTIPID=35)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @TOPIC='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MT_ID') THEN
						SELECT MT_TOPIC INTO @TOPIC FROM LMC_MEETING_TOPIC WHERE MT_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MT_TOPIC=',@TOPIC);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN
				
				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @TOPIC='<NULL>';
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='MT_ID') THEN
						SELECT MT_TOPIC INTO @TOPIC FROM LMC_MEETING_TOPIC WHERE MT_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('MT_TOPIC=',@TOPIC);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP;  

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_REPORT_DOCUMENT_CATEGORY,USER_LOGIN_DETAILS,LMC_EMPLOYEE_TEAM_DETAILS
		IF (@TTIPID=36) OR  (@TTIPID=3) or (@TTIPID=14)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
					END IF;
					
					IF (@TTIPID=36) OR (@TTIPID=14) THEN
					-- CONVERTING ULD_ID INTO ULDLOGINID
						IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
							SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
							SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
							SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
						END IF;
					END IF;

					IF (UPPER(@FIELD_NAME)='ULD_USERSTAMP') THEN
						SELECT ULD_USERNAME INTO @US FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@US);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='RC_ID') THEN
						SELECT RC_NAME INTO @ROLENAME FROM LMC_ROLE_CREATION WHERE RC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ROLE_NAME=',@ROLENAME);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TC_ID') THEN
						SELECT TEAM_NAME INTO @TEAMNAME FROM LMC_TEAM_CREATION WHERE TC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TEAM_NAME=',@TEAMNAME);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='WD_ID') THEN
						SELECT WD_DESIGNATION INTO @DESIGNATION FROM LMC_WORKER_DESIGNATION WHERE WD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('WD_DESIGNATION=',@DESIGNATION);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='ETD_USERSTAMP_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN
				
				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
				IF (@TTIPID=36) OR (@TTIPID=14) THEN
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;
				END IF;

					IF (UPPER(@FIELD_NAME)='ULD_USERSTAMP') THEN
						SELECT ULD_USERNAME INTO @US FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@US);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;
					IF (UPPER(@FIELD_NAME)='RC_ID') THEN
						SELECT RC_NAME INTO @ROLENAME FROM LMC_ROLE_CREATION WHERE RC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ROLE_NAME=',@ROLENAME);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='TC_ID') THEN
						SELECT TEAM_NAME INTO @TEAMNAME FROM LMC_TEAM_CREATION WHERE TC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('TEAM_NAME=',@TEAMNAME);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='WD_ID') THEN
						SELECT WD_DESIGNATION INTO @DESIGNATION FROM LMC_WORKER_DESIGNATION WHERE WD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('WD_DESIGNATION=',@DESIGNATION);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='ETD_USERSTAMP_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERSTAMP=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;



					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP;  

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 

-- LMC_REPORT_ATTACHMENT_DETAILS
		IF (@TTIPID=37)THEN

			IF (@TH_OLDVALUE IS NOT NULL) THEN

				UARD_OLD_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_OLDVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_OLDVALUE;
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @CATEGORY='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='RDC_ID') THEN
						SELECT RDC_CATEGORY INTO @CATEGORY FROM LMC_REPORT_DOCUMENT_CATEGORY WHERE RDC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('RDC_CATEGORY=',@CATEGORY);
						SELECT REPLACE(TEMP_TH_OLDVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_OLDVALUE;
					END IF;

					IF @TH_OLDVALUE IS NULL THEN
						LEAVE UARD_OLD_LOOP;
					END IF;

				END LOOP; 

			END IF;

			IF (@TH_NEWVALUE IS NOT NULL) THEN
				
				UARD_NEW_LOOP : LOOP

					SET @VALUE=NULL;
					SET @REMAINING_STRING=NULL;
					SET @FIELD_NAME=NULL;
					SET @COLUMN_VALUE=NULL;

					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TH_NEWVALUE,@VALUE,@REMAINING_STRING);
					SELECT @REMAINING_STRING INTO @TH_NEWVALUE;          
					CALL SP_LMC_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('=',@VALUE,@FIELD_NAME,@COLUMN_VALUE);
					
					IF(@COLUMN_VALUE='<NULL>' OR @COLUMN_VALUE='')THEN
						SET @LOGINID='<NULL>';
						SET @CATEGORY='<NULL>';
					END IF;
					
					-- CONVERTING ULD_ID INTO ULDLOGINID
					IF (UPPER(@FIELD_NAME)='ULD_ID') THEN
						SELECT ULD_USERNAME INTO @LOGINID FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('ULD_USERNAME=',@LOGINID);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF (UPPER(@FIELD_NAME)='RDC_ID') THEN
						SELECT RDC_CATEGORY INTO @CATEGORY FROM LMC_REPORT_DOCUMENT_CATEGORY WHERE RDC_ID=@COLUMN_VALUE;
						SET @REPLACE_STRING=CONCAT('RDC_CATEGORY=',@CATEGORY);
						SELECT REPLACE(TEMP_TH_NEWVALUE,@VALUE,@REPLACE_STRING) INTO TEMP_TH_NEWVALUE;
					END IF;

					IF @TH_NEWVALUE IS NULL THEN
						LEAVE UARD_NEW_LOOP;
					END IF;

				END LOOP;  

			END IF;

			SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
			SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		END IF; 



		SET @T_NEW_VALUE=TEMP_TH_NEWVALUE;
		SET @T_OLD_VALUE=TEMP_TH_OLDVALUE;

		IF(@TPID=1)THEN
			SET @INSERT_TEMP_UARD_TICKLER_HISTORY=(SELECT CONCAT('INSERT INTO ',TEMP_UARD_TICKLER_HISTORY,' VALUES (@THID,@EMPL_ID,@EMPL_NAME,
			(SELECT TP_TYPE FROM LMC_TICKLER_PROFILE WHERE TP_ID=@TPID),(SELECT TTIP_DATA FROM LMC_TICKLER_TABID_PROFILE WHERE TTIP_ID=@TTIPID),@T_OLD_VALUE,@T_NEW_VALUE,(SELECT ULD_USERNAME FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@THUSERSTAMP),@THTIMESTAMP)'));
			PREPARE INSERT_TEMP_UARD_TICKLER_HISTORY_STMT FROM @INSERT_TEMP_UARD_TICKLER_HISTORY;
			EXECUTE INSERT_TEMP_UARD_TICKLER_HISTORY_STMT;
		END IF;

		IF(@TPID=2)THEN
			SET @INSERT_TEMP_UARD_TICKLER_HISTORY=(SELECT CONCAT('INSERT INTO ',TEMP_UARD_TICKLER_HISTORY,'(TH_ID,ULD_ID,WORKER_NAME,EVENT_TYPE,TABLE_NAME,TH_OLD_VALUE,TH_USERSTAMP,TH_TIMESTAMP) VALUES (@THID,@EMPL_ID,@EMPL_NAME,
			(SELECT TP_TYPE FROM LMC_TICKLER_PROFILE WHERE TP_ID=@TPID),(SELECT TTIP_DATA FROM LMC_TICKLER_TABID_PROFILE WHERE TTIP_ID=@TTIPID),@T_OLD_VALUE,(SELECT ULD_USERNAME FROM LMC_USER_LOGIN_DETAILS WHERE ULD_ID=@THUSERSTAMP),@THTIMESTAMP)'));
			PREPARE INSERT_TEMP_UARD_TICKLER_HISTORY_STMT FROM @INSERT_TEMP_UARD_TICKLER_HISTORY;
			EXECUTE INSERT_TEMP_UARD_TICKLER_HISTORY_STMT;
		END IF;

		SET TH_MINID=TH_MINID + 1;
		SET @T_NEW_VALUE=NULL;
		SET @T_OLD_VALUE=NULL;

	END WHILE;
	
	SET @DROP_TEMP_TICKLER_HISTORY=(SELECT CONCAT('DROP TABLE IF EXISTS ',TEMP_TICKLER_HISTORY));
	PREPARE DROP_TEMP_TICKLER_HISTORY_STMT FROM @DROP_TEMP_TICKLER_HISTORY;
	EXECUTE DROP_TEMP_TICKLER_HISTORY_STMT;

	COMMIT;

END;