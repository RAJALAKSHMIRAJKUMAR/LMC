-- VER0.1 DATE:27/03/2015 DESC:CHECK CONSTRAINTS FOR LMC_USER_LOGIN_DETAILS DONE BY:RL

DROP PROCEDURE IF EXISTS SP_LMC_USER_LOGIN_DETAILS_VALIDATION;
CREATE PROCEDURE SP_LMC_USER_LOGIN_DETAILS_VALIDATION(
IN MOBILE_NO VARCHAR(10),
IN PROCESS VARCHAR(10))

BEGIN
	
	DECLARE ERROR_MSG TEXT;
	DECLARE MESSAGE_TEXT TEXT;
	
	IF((PROCESS='INSERT') OR (PROCESS='UPDATE'))THEN
		
		IF (MOBILE_NO IS NOT NULL) THEN
			
			IF (LENGTH(MOBILE_NO)!=8) THEN
				
				SET ERROR_MSG=(SELECT EMC_DATA FROM LMC_ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=37);
				SET ERROR_MSG=(SELECT REPLACE(ERROR_MSG,'[MOB NO]',MOBILE_NO));
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT=ERROR_MSG;
			
			END IF;
		
		END IF;
		
	END IF;

END;